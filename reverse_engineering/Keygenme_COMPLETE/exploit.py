import pwn
import re

a = 0x7b4654436f636970
b = 0x30795f676e317262
c = 0x6b5f6e77305f7275
d = 0x5f7933
e = 0x7d


knownFlagLength = 36

partialFlag = [a, b, c, d, e]
partialFlag = [pwn.p64(i) for i in partialFlag]
partialFlag = b"".join(partialFlag).replace(b"\x00", b"")

filler = b"A"*(knownFlagLength - len(partialFlag))

payload = partialFlag + filler

breakpoint = "0x555555555432"
flagAddr = "0x7fffffffd8d0"

p = pwn.process('./keygenme')

with open('payload', 'wb') as filp:
    filp.write(payload)

pwn.gdb.attach(p, f'''
               set logging on
               b *{breakpoint}
               r < payload
               x/s {flagAddr} 
               ''')

gdbLog = open('gdb.txt', 'r').read()

flag = re.findall('picoCTF{.*}', gdbLog)[-1]

with open('flag.txt', 'w') as filp:
    filp.write(flag)
